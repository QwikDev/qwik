---
phase: 02-dev-mode-validation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .planning/phases/02-dev-mode-validation/02-01-VERIFICATION.md
autonomous: true

must_haves:
  truths:
    - "Dev server starts and serves the e2e app"
    - "Client environment renders interactive components in browser"
    - "SSR environment generates server-rendered HTML"
    - "Page response contains serialized Qwik state (q:container)"
  artifacts:
    - path: ".planning/phases/02-dev-mode-validation/02-01-VERIFICATION.md"
      provides: "Dev mode rendering verification report"
      contains: "DEV-01"
  key_links:
    - from: "Vite dev server"
      to: "environments.client module graph"
      via: "browser request for client JS"
      pattern: "console.*client"
    - from: "Vite dev server"
      to: "environments.ssr module graph"
      via: "SSR middleware"
      pattern: "console.*ssr"
---

<objective>
Validate that the Vite dev server correctly uses Environment API with per-environment module graphs.

Purpose: Prove DEV-01 (client renders using environments.client) and DEV-02 (SSR renders using environments.ssr) are satisfied through automated browser testing of the existing e2e app.

Output: Verification report documenting dev server behavior with evidence of both environments working.
</objective>

<execution_context>
@/Users/jackshelton/.claude/get-shit-done/workflows/execute-plan.md
@/Users/jackshelton/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-dev-mode-validation/02-CONTEXT.md
@.planning/phases/01-environment-api-activation/01-01-VERIFICATION.md
@starters/apps/e2e/src/root.tsx
@packages/qwik/src/optimizer/src/plugins/vite.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Start dev server and verify basic operation</name>
  <files>None (verification only)</files>
  <action>
Start the Qwik dev server using the existing e2e app:

1. Navigate to the project root
2. Run `pnpm dev` or find the correct dev server command in package.json
3. Wait for server to start (look for "ready" or port binding message)
4. Verify the server binds to expected port (typically 5173 or 3000)

If using starters dev-server.ts:
- Run `pnpm tsx starters/dev-server.ts` or equivalent
- Server should list available starter apps

Capture:
- Server startup output
- Port number
- Any environment-related log messages
  </action>
  <verify>Server is running and accessible at http://localhost:{port}</verify>
  <done>Dev server starts without errors and binds to a port</done>
</task>

<task type="auto">
  <name>Task 2: Validate client and SSR rendering with browser</name>
  <files>None (verification only)</files>
  <action>
Use agent-browser to test the dev server:

1. Navigate to the e2e app's toggle component (typically at /e2e/toggle)
2. Verify page loads with server-rendered HTML:
   - Check for `q:container` attribute in the HTML (proves SSR)
   - Check for `q:base` attribute
3. Test client interactivity:
   - Find a toggle or counter component
   - Click to trigger state change
   - Verify UI updates (proves client JS is working)
4. Check browser console for errors
5. Verify network requests use environment-appropriate module resolution

Key evidence to capture:
- Screenshot of rendered page
- HTML source showing q:container (SSR proof)
- Evidence of client-side interaction working
- Any environment-related console output
  </action>
  <verify>
1. Page renders with q:container attribute (SSR worked)
2. Interactive element responds to clicks (client JS works)
3. No critical errors in browser console
  </verify>
  <done>
DEV-01: Client renders using environments.client module graph (interactive)
DEV-02: SSR renders using environments.ssr module graph (q:container present)
  </done>
</task>

<task type="auto">
  <name>Task 3: Create verification report</name>
  <files>.planning/phases/02-dev-mode-validation/02-01-VERIFICATION.md</files>
  <action>
Create verification report documenting:

1. Dev server startup (command used, port, startup time)
2. SSR verification:
   - Evidence of q:container attribute
   - Environment used (ssr)
3. Client verification:
   - Evidence of interactive behavior
   - Environment used (client)
4. Requirements status:
   - DEV-01: [PASS/FAIL] with evidence
   - DEV-02: [PASS/FAIL] with evidence

Include relevant console output excerpts and observations.
  </action>
  <verify>Report exists at .planning/phases/02-dev-mode-validation/02-01-VERIFICATION.md</verify>
  <done>Verification report documents DEV-01 and DEV-02 status with evidence</done>
</task>

</tasks>

<verification>
Phase checks:
1. Dev server starts successfully
2. Browser can access e2e app
3. SSR generates q:container HTML
4. Client JS enables interactivity
5. Both environments (client and ssr) are used correctly
</verification>

<success_criteria>
- DEV-01 verified: Client environment renders interactive components
- DEV-02 verified: SSR environment generates server HTML
- Verification report created with evidence
</success_criteria>

<output>
After completion, create `.planning/phases/02-dev-mode-validation/02-01-SUMMARY.md`
</output>
