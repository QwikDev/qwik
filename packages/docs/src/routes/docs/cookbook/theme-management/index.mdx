---
title: Cookbook | Dark and Light Theme
contributors:
  - Inaam-Ur-Rehman
  - gioboa
  - aendel
  - chindris-mihai-alexandru
updated_at: '2026-01-09T00:00:00Z'
created_at: '2023-10-10T16:59:26Z'
---

import PackageManagerTabs from '~/components/package-manager-tabs/index.tsx';

# Theme management

In modern websites, dark and light theme support creates a better user experience. Users can change the theme according to their preferences or system settings.

This guide covers theme management with Tailwind CSS, including solutions for Static Site Generation (SSG) and Content Security Policy (CSP) considerations.

## Setup Tailwind CSS

First, install Tailwind CSS in your Qwik project:

<PackageManagerTabs>
<span q:slot="pnpm">
```shell
pnpm run qwik add tailwind
```
</span>
<span q:slot="npm">
```shell
npm run qwik add tailwind
```
</span>
<span q:slot="yarn">
```shell
yarn run qwik add tailwind
```
</span>
<span q:slot="bun">
```shell
bun run qwik add tailwind
```
</span>
</PackageManagerTabs>

Enable dark mode in your `tailwind.config.js`:

```js
module.exports = {
  content: ["./src/**/*.{js,ts,jsx,tsx,mdx}"],
  darkMode: "class",
  theme: {},
  plugins: [],
};
```

## Basic Implementation

### Step 1: Add the theme initialization script

Add this script to the `<head>` in your `root.tsx` file. This script runs before the page renders, preventing a flash of the wrong theme:

```tsx
// In root.tsx, inside the <head> tag
<script
  dangerouslySetInnerHTML={`
    (function() {
      function setTheme(theme) {
        document.documentElement.className = theme;
        localStorage.setItem('theme', theme);
      }
      var theme = localStorage.getItem('theme');
      if (theme) {
        setTheme(theme);
      } else {
        if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
          setTheme('dark');
        } else {
          setTheme('light');
        }
      }
    })();
  `}
/>
```

### Step 2: Create the theme toggle component

```tsx
import { component$ } from "@builder.io/qwik";

export const ThemeToggle = component$(() => {
  return (
    <button
      type="button"
      aria-label="Toggle dark mode"
      onClick$={() => {
        const currentTheme = document.documentElement.className;
        const newTheme = currentTheme === "dark" ? "light" : "dark";
        document.documentElement.className = newTheme;
        localStorage.setItem("theme", newTheme);
      }}
      class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700"
    >
      {/* Sun icon for dark mode, Moon icon for light mode */}
      <svg class="w-5 h-5 hidden dark:block" fill="currentColor" viewBox="0 0 20 20">
        <path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" />
      </svg>
      <svg class="w-5 h-5 block dark:hidden" fill="currentColor" viewBox="0 0 20 20">
        <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z" />
      </svg>
    </button>
  );
});
```

## SSG (Static Site Generation) Considerations

When using Static Site Generation with adapters like Cloudflare Pages, Netlify, or the static adapter, your pages are pre-rendered at build time. This means:

1. **No server-side request handling** - The `plugin@csp.ts` middleware won't run for static pages
2. **Theme must be set before first paint** - To avoid the "flash of wrong theme" problem

### Why the inline script approach works for SSG

The inline script in `<head>` executes synchronously before the browser renders any content. This is critical for SSG because:

- `useVisibleTask$` runs **after** the component mounts (too late - causes flicker)
- `useTask$` runs on the server during SSR, but for SSG the HTML is already static
- The inline script runs immediately when the HTML is parsed, before any rendering

### Using `useVisibleTask$` for the toggle button

While the initial theme must be set via inline script, you can use `useVisibleTask$` with the `document-ready` strategy for the toggle button to sync its visual state:

```tsx
import { component$, useSignal, useVisibleTask$ } from "@builder.io/qwik";

export const ThemeToggle = component$(() => {
  const theme = useSignal<string>('light');

  // Sync the signal with the actual theme on mount
  useVisibleTask$(
    () => {
      theme.value = document.documentElement.className || 'light';
    },
    { strategy: 'document-ready' }
  );

  return (
    <button
      type="button"
      aria-label="Toggle dark mode"
      onClick$={() => {
        const newTheme = theme.value === "dark" ? "light" : "dark";
        document.documentElement.className = newTheme;
        localStorage.setItem("theme", newTheme);
        theme.value = newTheme;
      }}
      class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700"
    >
      {theme.value === 'dark' ? '‚òÄÔ∏è' : 'üåô'}
    </button>
  );
});
```

The `{ strategy: 'document-ready' }` option makes the task run as soon as the document is ready, rather than waiting for the component to become visible.

## Content Security Policy (CSP) Considerations

The inline script approach using `dangerouslySetInnerHTML` requires CSP configuration. You have two options:

### Option 1: Allow unsafe-inline (simpler, slightly less secure)

For static sites deployed to platforms like Cloudflare Pages, add a `_headers` file in your `public/` folder:

```
/*
  Content-Security-Policy: default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'; frame-ancestors 'none'; object-src 'none'
```

### Option 2: Use nonces (SSR only)

For SSR applications, you can use nonces as described in the [CSP documentation](/docs/advanced/content-security-policy/). Note that nonces **do not work with SSG** because the nonce must be generated per-request.

### Option 3: Use script hashes (advanced)

You can calculate a SHA-256 hash of your inline script and add it to CSP:

```
script-src 'self' 'sha256-YOUR_SCRIPT_HASH_HERE'
```

Generate the hash using:
```shell
echo -n 'your inline script content' | openssl dgst -sha256 -binary | openssl base64
```

## Complete Example for SSG

Here's a complete `root.tsx` setup for a Qwik site using SSG with Cloudflare Pages:

```tsx
import { component$ } from "@builder.io/qwik";
import {
  QwikCityProvider,
  RouterOutlet,
  ServiceWorkerRegister,
} from "@builder.io/qwik-city";
import { RouterHead } from "./components/router-head/router-head";
import { ThemeToggle } from "./components/theme-toggle/theme-toggle";

import "./global.css";

// Inline script to set theme before first paint
const themeScript = `
(function() {
  var STORAGE_KEY = 'theme';
  var stored = localStorage.getItem(STORAGE_KEY);
  var theme = stored || (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
  document.documentElement.classList.add(theme);
})();
`;

export default component$(() => {
  return (
    <QwikCityProvider>
      <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="manifest" href="/manifest.json" />
        <script dangerouslySetInnerHTML={themeScript} />
        <RouterHead />
        <ServiceWorkerRegister />
      </head>
      <body lang="en" class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white">
        <ThemeToggle />
        <RouterOutlet />
      </body>
    </QwikCityProvider>
  );
});
```

## Troubleshooting

### Theme flickers on page load

If you see a flash of the wrong theme:
1. Ensure the inline script is in `<head>`, not `<body>`
2. Check that the script runs synchronously (no `async` or `defer`)
3. Verify the script is setting the class on `document.documentElement`

### Toggle button shows wrong state initially

Use `useVisibleTask$` with `{ strategy: 'document-ready' }` to sync the button state with the actual theme after hydration.

### CSP errors in console

Check your browser's console for CSP violation messages. You'll need to either:
- Add `'unsafe-inline'` to `script-src` 
- Calculate and add the script's hash
- Use nonces (SSR only)

## Related

- [Content Security Policy](/docs/advanced/content-security-policy/) - For SSR applications using nonces
- [Static Site Generation](/docs/guides/static-site-generation/) - SSG configuration
- [useVisibleTask$](/docs/components/tasks/#usevisibletask) - Client-side tasks
