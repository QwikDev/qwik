---
source: packages/qwik/src/optimizer/core/src/test.rs
assertion_line: 106
expression: output
---
==INPUT==


import { $, component$, isDev, QRL, useSignal, useTask$, useOnDocument, useContext } from "@qwik.dev/core";
import { contextCounterId } from "./context";
import { externalHelper } from "./helpers";

let globEnv = isDev ? "dev" : "prod";
globEnv = "special";
export const topLevelHelper = () => {
  if (globEnv === "special") console.log("topLevelHelper");
};

export const TestButton = component$(
  ({ onTripleClick$ }: { onTripleClick$: QRL<() => void> }) => {
    let env = isDev ? "dev" : "prod";
    env = "special";

    const counter = useSignal(0);

	const innerInnerHelper$ = $(() => {
		console.log("innerInnerHelper$");
	});

    const innerHelper$ = $(async (param1: number, {param2, param3}: {param2: number, param3: number}) => {
		counter.value = counter.value + param1 + param2 + param3;
		if (env === "special" && globEnv === "special") console.log("innerHelper$");
		topLevelHelper();
		externalHelper();
		await innerInnerHelper$();
    });

	const contextCounter = useContext(contextCounterId);

	useTask$(() => {
		contextCounter.value += 10;
	});

    useOnDocument("mousemove", $(async (event) => {
		console.log("mousemove", event);
		counter.value++;
		if(contextCounter.value > 10) console.log("contextCounter", contextCounter.value);
		topLevelHelper();
		await innerHelper$(1, {param2: 2, param3: 3});
    }));

    return (
      <>
        <button
          onClick$={[
            $(async () => {
              topLevelHelper();
			  await innerInnerHelper$();
              await innerHelper$(1, {param2: 2, param3: 3});
              counter.value++;
            }),
            $(async () => {
              await onTripleClick$();
            }),
          ]}
        >
          {counter.value}
        </button>
      </>
    );
  }
);

============================= test.js ==

import { componentQrl } from "@qwik.dev/core";
import { qrl } from "@qwik.dev/core";
const i_uFrpfTnm3bA = ()=>import("./test.tsx_TestButton_component_uFrpfTnm3bA");
import { isDev } from "@qwik.dev/core";
let globEnv = isDev ? "dev" : "prod";
globEnv = "special";
export const topLevelHelper = ()=>{
    if (globEnv === "special") console.log("topLevelHelper");
};
export const TestButton = /*#__PURE__*/ componentQrl(/*#__PURE__*/ qrl(i_uFrpfTnm3bA, "TestButton_component_uFrpfTnm3bA"));
export { globEnv as _auto_globEnv };


Some("{\"version\":3,\"sources\":[\"/user/qwik/src/test.tsx\"],\"names\":[],\"mappings\":\";;;AACA,SAAwB,KAAK,QAA6D,iBAAiB;AAI3G,IAAI,UAAU,QAAQ,QAAQ;AAC9B,UAAU;AACV,OAAO,MAAM,iBAAiB;IAC5B,IAAI,YAAY,WAAW,QAAQ,GAAG,CAAC;AACzC,EAAE;AAEF,OAAO,MAAM,2BAAa,mFAqDxB\"}")
============================= test.tsx_TestButton_component_Fragment_button_q_e_click_1_0YD06DOCnSs.js (ENTRY POINT)==

import { _captures } from "@qwik.dev/core";
export const TestButton_component_Fragment_button_q_e_click_1_0YD06DOCnSs = async ()=>{
    const _rawProps = _captures[0];
    await _rawProps.onTripleClick$();
};


Some("{\"version\":3,\"sources\":[\"/user/qwik/src/test.tsx\"],\"names\":[],\"mappings\":\";4EAsDc;;IACA,MAAM,UA3Cf\"}")
/*
{
  "origin": "test.tsx",
  "name": "TestButton_component_Fragment_button_q_e_click_1_0YD06DOCnSs",
  "entry": null,
  "displayName": "test.tsx_TestButton_component_Fragment_button_q_e_click_1",
  "hash": "0YD06DOCnSs",
  "canonicalFilename": "test.tsx_TestButton_component_Fragment_button_q_e_click_1_0YD06DOCnSs",
  "path": "",
  "extension": "js",
  "parent": "TestButton_component_uFrpfTnm3bA",
  "ctxKind": "function",
  "ctxName": "$",
  "captures": true,
  "loc": [
    1616,
    1681
  ],
  "captureNames": [
    "_rawProps"
  ]
}
*/
============================= test.tsx_TestButton_component_useOnDocument_ke1LKtHBiD8.js (ENTRY POINT)==

import { _captures } from "@qwik.dev/core";
import { topLevelHelper } from "./test";
export const TestButton_component_useOnDocument_ke1LKtHBiD8 = async (event)=>{
    const contextCounter = _captures[0], counter = _captures[1], innerHelper$ = _captures[2];
    console.log("mousemove", event);
    counter.value++;
    if (contextCounter.value > 10) console.log("contextCounter", contextCounter.value);
    topLevelHelper();
    await innerHelper$(1, {
        param2: 2,
        param3: 3
    });
};


Some("{\"version\":3,\"sources\":[\"/user/qwik/src/test.tsx\"],\"names\":[],\"mappings\":\";;8DAoCiC,OAAO;;IACtC,QAAQ,GAAG,CAAC,aAAa;IACzB,QAAQ,KAAK;IACb,IAAG,eAAe,KAAK,GAAG,IAAI,QAAQ,GAAG,CAAC,kBAAkB,eAAe,KAAK;IAChF;IACA,MAAM,aAAa,GAAG;QAAC,QAAQ;QAAG,QAAQ;IAAC\"}")
/*
{
  "origin": "test.tsx",
  "name": "TestButton_component_useOnDocument_ke1LKtHBiD8",
  "entry": null,
  "displayName": "test.tsx_TestButton_component_useOnDocument",
  "hash": "ke1LKtHBiD8",
  "canonicalFilename": "test.tsx_TestButton_component_useOnDocument_ke1LKtHBiD8",
  "path": "",
  "extension": "js",
  "parent": "TestButton_component_uFrpfTnm3bA",
  "ctxKind": "function",
  "ctxName": "$",
  "captures": true,
  "loc": [
    1105,
    1337
  ],
  "paramNames": [
    "event"
  ],
  "captureNames": [
    "contextCounter",
    "counter",
    "innerHelper$"
  ]
}
*/
============================= test.tsx_TestButton_component_useTask_K6S9SSHyiUc.js (ENTRY POINT)==

import { _captures } from "@qwik.dev/core";
export const TestButton_component_useTask_K6S9SSHyiUc = ()=>{
    const contextCounter = _captures[0];
    contextCounter.value += 10;
};


Some("{\"version\":3,\"sources\":[\"/user/qwik/src/test.tsx\"],\"names\":[],\"mappings\":\";wDAgCU;;IACR,eAAe,KAAK,IAAI\"}")
/*
{
  "origin": "test.tsx",
  "name": "TestButton_component_useTask_K6S9SSHyiUc",
  "entry": null,
  "displayName": "test.tsx_TestButton_component_useTask",
  "hash": "K6S9SSHyiUc",
  "canonicalFilename": "test.tsx_TestButton_component_useTask_K6S9SSHyiUc",
  "path": "",
  "extension": "js",
  "parent": "TestButton_component_uFrpfTnm3bA",
  "ctxKind": "function",
  "ctxName": "useTask$",
  "captures": true,
  "loc": [
    1028,
    1068
  ],
  "captureNames": [
    "contextCounter"
  ]
}
*/
============================= test.tsx_TestButton_component_Fragment_button_q_e_click_hOLZleZIsX4.js (ENTRY POINT)==

import { _captures } from "@qwik.dev/core";
import { topLevelHelper } from "./test";
export const TestButton_component_Fragment_button_q_e_click_hOLZleZIsX4 = async ()=>{
    const counter = _captures[0], innerHelper$ = _captures[1], innerInnerHelper$ = _captures[2];
    topLevelHelper();
    await innerInnerHelper$();
    await innerHelper$(1, {
        param2: 2,
        param3: 3
    });
    counter.value++;
};


Some("{\"version\":3,\"sources\":[\"/user/qwik/src/test.tsx\"],\"names\":[],\"mappings\":\";;0EAgDc;;IACA;IACT,MAAM;IACG,MAAM,aAAa,GAAG;QAAC,QAAQ;QAAG,QAAQ;IAAC;IAC3C,QAAQ,KAAK\"}")
/*
{
  "origin": "test.tsx",
  "name": "TestButton_component_Fragment_button_q_e_click_hOLZleZIsX4",
  "entry": null,
  "displayName": "test.tsx_TestButton_component_Fragment_button_q_e_click",
  "hash": "hOLZleZIsX4",
  "canonicalFilename": "test.tsx_TestButton_component_Fragment_button_q_e_click_hOLZleZIsX4",
  "path": "",
  "extension": "js",
  "parent": "TestButton_component_uFrpfTnm3bA",
  "ctxKind": "function",
  "ctxName": "$",
  "captures": true,
  "loc": [
    1416,
    1599
  ],
  "captureNames": [
    "counter",
    "innerHelper$",
    "innerInnerHelper$"
  ]
}
*/
============================= test.tsx_TestButton_component_uFrpfTnm3bA.js (ENTRY POINT)==

import { Fragment as _Fragment } from "@qwik.dev/core/jsx-runtime";
import { _jsxSorted } from "@qwik.dev/core";
import { _wrapProp } from "@qwik.dev/core";
import { contextCounterId } from "./context";
import { isDev } from "@qwik.dev/core";
import { qrl } from "@qwik.dev/core";
import { useContext } from "@qwik.dev/core";
import { useOnDocument } from "@qwik.dev/core";
import { useSignal } from "@qwik.dev/core";
import { useTaskQrl } from "@qwik.dev/core";
const i_0YD06DOCnSs = ()=>import("./test.tsx_TestButton_component_Fragment_button_q_e_click_1_0YD06DOCnSs");
const i_Edy17D0e3sg = ()=>import("./test.tsx_TestButton_component_innerHelper_Edy17D0e3sg");
const i_K6S9SSHyiUc = ()=>import("./test.tsx_TestButton_component_useTask_K6S9SSHyiUc");
const i_PqCJvh1cYuo = ()=>import("./test.tsx_TestButton_component_innerInnerHelper_PqCJvh1cYuo");
const i_hOLZleZIsX4 = ()=>import("./test.tsx_TestButton_component_Fragment_button_q_e_click_hOLZleZIsX4");
const i_ke1LKtHBiD8 = ()=>import("./test.tsx_TestButton_component_useOnDocument_ke1LKtHBiD8");
export const TestButton_component_uFrpfTnm3bA = (_rawProps)=>{
    let env = isDev ? "dev" : "prod";
    env = "special";
    const counter = useSignal(0);
    const innerInnerHelper$ = /*#__PURE__*/ qrl(i_PqCJvh1cYuo, "TestButton_component_innerInnerHelper_PqCJvh1cYuo");
    const innerHelper$ = /*#__PURE__*/ qrl(i_Edy17D0e3sg, "TestButton_component_innerHelper_Edy17D0e3sg", [
        counter,
        env,
        innerInnerHelper$
    ]);
    const contextCounter = useContext(contextCounterId);
    useTaskQrl(/*#__PURE__*/ qrl(i_K6S9SSHyiUc, "TestButton_component_useTask_K6S9SSHyiUc", [
        contextCounter
    ]));
    useOnDocument("mousemove", /*#__PURE__*/ qrl(i_ke1LKtHBiD8, "TestButton_component_useOnDocument_ke1LKtHBiD8", [
        contextCounter,
        counter,
        innerHelper$
    ]));
    return /*#__PURE__*/ _jsxSorted(_Fragment, null, null, /*#__PURE__*/ _jsxSorted("button", {
        "q-e:click": [
            /*#__PURE__*/ qrl(i_hOLZleZIsX4, "TestButton_component_Fragment_button_q_e_click_hOLZleZIsX4", [
                counter,
                innerHelper$,
                innerInnerHelper$
            ]),
            /*#__PURE__*/ qrl(i_0YD06DOCnSs, "TestButton_component_Fragment_button_q_e_click_1_0YD06DOCnSs", [
                _rawProps
            ])
        ]
    }, null, _wrapProp(counter), 2, null), 1, "u6_0");
};


Some("{\"version\":3,\"sources\":[\"/user/qwik/src/test.tsx\"],\"names\":[],\"mappings\":\";;;;;;;;;;;;;;;;gDAYE;IACE,IAAI,MAAM,QAAQ,QAAQ;IAC1B,MAAM;IAEN,MAAM,UAAU,UAAU;IAE7B,MAAM;IAIH,MAAM;;;;;IAQT,MAAM,iBAAiB,WAAW;IAElC;;;IAIG,cAAc;;;;;IAQd,qBACE,gDACE,WAAC;QACC,aAAU;;;;;;;;;SAUT;uBAEA;AAIT\"}")
/*
{
  "origin": "test.tsx",
  "name": "TestButton_component_uFrpfTnm3bA",
  "entry": null,
  "displayName": "test.tsx_TestButton_component",
  "hash": "uFrpfTnm3bA",
  "canonicalFilename": "test.tsx_TestButton_component_uFrpfTnm3bA",
  "path": "",
  "extension": "js",
  "parent": null,
  "ctxKind": "function",
  "ctxName": "component$",
  "captures": false,
  "loc": [
    402,
    1771
  ],
  "paramNames": [
    "_rawProps"
  ]
}
*/
============================= test.tsx_TestButton_component_innerHelper_Edy17D0e3sg.js (ENTRY POINT)==

import { _captures } from "@qwik.dev/core";
import { externalHelper } from "./helpers";
import { _auto_globEnv as globEnv } from "./test";
import { topLevelHelper } from "./test";
export const TestButton_component_innerHelper_Edy17D0e3sg = async (param1, { param2, param3 })=>{
    const counter = _captures[0], env = _captures[1], innerInnerHelper$ = _captures[2];
    counter.value = counter.value + param1 + param2 + param3;
    if (env === "special" && globEnv === "special") console.log("innerHelper$");
    topLevelHelper();
    externalHelper();
    await innerInnerHelper$();
};


Some("{\"version\":3,\"sources\":[\"/user/qwik/src/test.tsx\"],\"names\":[],\"mappings\":\";;;;4DAsB2B,OAAO,QAAgB,EAAC,MAAM,EAAE,MAAM,EAAmC;;IAClG,QAAQ,KAAK,GAAG,QAAQ,KAAK,GAAG,SAAS,SAAS;IAClD,IAAI,QAAQ,aAAa,YAAY,WAAW,QAAQ,GAAG,CAAC;IAC5D;IACA;IACA,MAAM\"}")
/*
{
  "origin": "test.tsx",
  "name": "TestButton_component_innerHelper_Edy17D0e3sg",
  "entry": null,
  "displayName": "test.tsx_TestButton_component_innerHelper",
  "hash": "Edy17D0e3sg",
  "canonicalFilename": "test.tsx_TestButton_component_innerHelper_Edy17D0e3sg",
  "path": "",
  "extension": "js",
  "parent": "TestButton_component_uFrpfTnm3bA",
  "ctxKind": "function",
  "ctxName": "$",
  "captures": true,
  "loc": [
    666,
    959
  ],
  "paramNames": [
    "param1",
    "{param2, param3}"
  ],
  "captureNames": [
    "counter",
    "env",
    "innerInnerHelper$"
  ]
}
*/
============================= test.tsx_TestButton_component_innerInnerHelper_PqCJvh1cYuo.js (ENTRY POINT)==

export const TestButton_component_innerInnerHelper_PqCJvh1cYuo = ()=>{
    console.log("innerInnerHelper$");
};


Some("{\"version\":3,\"sources\":[\"/user/qwik/src/test.tsx\"],\"names\":[],\"mappings\":\"iEAkB6B;IAC3B,QAAQ,GAAG,CAAC;AACb\"}")
/*
{
  "origin": "test.tsx",
  "name": "TestButton_component_innerInnerHelper_PqCJvh1cYuo",
  "entry": null,
  "displayName": "test.tsx_TestButton_component_innerInnerHelper",
  "hash": "PqCJvh1cYuo",
  "canonicalFilename": "test.tsx_TestButton_component_innerInnerHelper_PqCJvh1cYuo",
  "path": "",
  "extension": "js",
  "parent": "TestButton_component_uFrpfTnm3bA",
  "ctxKind": "function",
  "ctxName": "$",
  "captures": false,
  "loc": [
    589,
    635
  ]
}
*/
== DIAGNOSTICS ==

[]
