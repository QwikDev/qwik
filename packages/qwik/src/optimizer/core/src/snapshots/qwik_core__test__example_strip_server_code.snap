---
source: packages/qwik/src/optimizer/core/src/test.rs
assertion_line: 1822
expression: output
snapshot_kind: text
---
==INPUT==


import { component$, serverLoader$, serverStuff$, $, client$, useStore, useTask$ } from '@qwik.dev/core';
import { isServer } from '@qwik.dev/core';
import mongo from 'mongodb';
import redis from 'redis';
import { handler } from 'serverless';

export const Parent = component$(() => {
	const state = useStore({
		text: ''
	});

	// Double count watch
	useTask$(async () => {
		if (!isServer) return;
		state.text = await mongo.users();
		redis.set(state.text);
	});

	serverStuff$(async () => {
		// should be removed too
		const a = $(() => {
			// from $(), should not be removed
		});
		const b = client$(() => {
			// from clien$(), should not be removed
		});
		return [a,b];
	})

	serverLoader$(handler);

	useTask$(() => {
		// Code
	});

	return (
		<div onClick$={() => console.log('parent')}>
			{state.text}
		</div>
	);
});

============================= test.tsx_Parent_useTask_2FGtjOskTRQ.js (ENTRY POINT)==

import { useLexicalScope } from "@qwik.dev/core";
import mongo from "mongodb";
import redis from "redis";
export const s_2FGtjOskTRQ = async ()=>{
    const [state] = useLexicalScope();
    state.text = await mongo.users();
    redis.set(state.text);
};


Some("{\"version\":3,\"sources\":[\"/user/qwik/src/test.tsx\"],\"names\":[],\"mappings\":\";;;6BAaU;;IAER,MAAM,IAAI,GAAG,MAAM,MAAM,KAAK;IAC9B,MAAM,GAAG,CAAC,MAAM,IAAI\"}")
/*
{
  "origin": "test.tsx",
  "name": "s_2FGtjOskTRQ",
  "entry": null,
  "displayName": "test.tsx_Parent_useTask",
  "hash": "2FGtjOskTRQ",
  "canonicalFilename": "test.tsx_Parent_useTask_2FGtjOskTRQ",
  "path": "",
  "extension": "js",
  "parent": "s_0TaiDayHrlo",
  "ctxKind": "function",
  "ctxName": "useTask$",
  "captures": true,
  "loc": [
    363,
    465
  ],
  "captureNames": [
    "state"
  ]
}
*/
============================= test.js ==

import { componentQrl } from "@qwik.dev/core";
import { qrl } from "@qwik.dev/core";
import { _addLoc } from "@qwik.dev/core/internal";
export const Parent = /*#__PURE__*/ _addLoc(componentQrl(/*#__PURE__*/ qrl(()=>import("./test.tsx_Parent_component_0TaiDayHrlo"), "s_0TaiDayHrlo")), "test.tsx", 9, 23);


Some("{\"version\":3,\"sources\":[\"/user/qwik/src/test.tsx\"],\"names\":[],\"mappings\":\";;;AAOA,OAAO,MAAM,uBAAS,QAAA,4HAkCnB\"}")
============================= test.tsx_Parent_component_0TaiDayHrlo.js (ENTRY POINT)==

import { _addLoc } from "@qwik.dev/core/internal";
import { _jsxSorted } from "@qwik.dev/core";
import { _noopQrl } from "@qwik.dev/core";
import { _wrapProp } from "@qwik.dev/core";
import { qrl } from "@qwik.dev/core";
import { serverLoaderQrl } from "@qwik.dev/core";
import { serverStuffQrl } from "@qwik.dev/core";
import { useStore } from "@qwik.dev/core";
import { useTaskQrl } from "@qwik.dev/core";
export const s_0TaiDayHrlo = ()=>{
    const state = _addLoc(useStore({
        text: ''
    }), "test.tsx", 10, 16);
    // Double count watch
    useTaskQrl(/*#__PURE__*/ qrl(()=>import("./test.tsx_Parent_useTask_2FGtjOskTRQ"), "s_2FGtjOskTRQ", [
        state
    ]));
    serverStuffQrl(/*#__PURE__*/ _noopQrl("s_24PkzVg0h0U"));
    serverLoaderQrl(/*#__PURE__*/ _noopQrl("s_Etjb6eZWcgo"));
    useTaskQrl(/*#__PURE__*/ qrl(()=>import("./test.tsx_useTask_NEuTKj8j8Nc"), "s_NEuTKj8j8Nc"));
    return /*#__PURE__*/ _jsxSorted("div", null, {
        onClick$: /*#__PURE__*/ qrl(()=>import("./test.tsx_div_onClick_xGBE9Cbd8Ik"), "s_xGBE9Cbd8Ik")
    }, _wrapProp(state, "text"), 1, "u6_0");
};


Some("{\"version\":3,\"sources\":[\"/user/qwik/src/test.tsx\"],\"names\":[],\"mappings\":\";;;;;;;;;6BAOiC;IAChC,MAAM,QAAQ,QAAA,SAAS;QACtB,MAAM;IACP;IAEA,qBAAqB;IACrB;;;IAMA;IAWA;IAEA;IAIA,qBACC,WAAC;QAAI,QAAQ;iBACX;AAGJ\"}")
/*
{
  "origin": "test.tsx",
  "name": "s_0TaiDayHrlo",
  "entry": null,
  "displayName": "test.tsx_Parent_component",
  "hash": "0TaiDayHrlo",
  "canonicalFilename": "test.tsx_Parent_component_0TaiDayHrlo",
  "path": "",
  "extension": "js",
  "parent": null,
  "ctxKind": "function",
  "ctxName": "component$",
  "captures": false,
  "loc": [
    279,
    835
  ]
}
*/
============================= test.tsx_div_onClick_xGBE9Cbd8Ik.js (ENTRY POINT)==

export const s_xGBE9Cbd8Ik = ()=>console.log('parent');


Some("{\"version\":3,\"sources\":[\"/user/qwik/src/test.tsx\"],\"names\":[],\"mappings\":\"6BAqCiB,IAAM,QAAQ,GAAG,CAAC\"}")
/*
{
  "origin": "test.tsx",
  "name": "s_xGBE9Cbd8Ik",
  "entry": null,
  "displayName": "test.tsx_div_onClick",
  "hash": "xGBE9Cbd8Ik",
  "canonicalFilename": "test.tsx_div_onClick_xGBE9Cbd8Ik",
  "path": "",
  "extension": "js",
  "parent": "s_0TaiDayHrlo",
  "ctxKind": "eventHandler",
  "ctxName": "onClick$",
  "captures": false,
  "loc": [
    775,
    802
  ]
}
*/
============================= test.tsx_Parent_b_client_JbkSeNwSBbE.js (ENTRY POINT)==

export const s_JbkSeNwSBbE = ()=>{
// from clien$(), should not be removed
};


Some("{\"version\":3,\"sources\":[\"/user/qwik/src/test.tsx\"],\"names\":[],\"mappings\":\"6BAwBoB;AACjB,uCAAuC;AACxC\"}")
/*
{
  "origin": "test.tsx",
  "name": "s_JbkSeNwSBbE",
  "entry": null,
  "displayName": "test.tsx_Parent_b_client",
  "hash": "JbkSeNwSBbE",
  "canonicalFilename": "test.tsx_Parent_b_client_JbkSeNwSBbE",
  "path": "",
  "extension": "js",
  "parent": "s_24PkzVg0h0U",
  "ctxKind": "function",
  "ctxName": "client$",
  "captures": false,
  "loc": [
    610,
    664
  ]
}
*/
============================= test.tsx_Parent_serverStuff_a_0Wq8TkNlVcM.js (ENTRY POINT)==

export const s_0Wq8TkNlVcM = ()=>{
// from $(), should not be removed
};


Some("{\"version\":3,\"sources\":[\"/user/qwik/src/test.tsx\"],\"names\":[],\"mappings\":\"6BAqBc;AACX,kCAAkC;AACnC\"}")
/*
{
  "origin": "test.tsx",
  "name": "s_0Wq8TkNlVcM",
  "entry": null,
  "displayName": "test.tsx_Parent_serverStuff_a",
  "hash": "0Wq8TkNlVcM",
  "canonicalFilename": "test.tsx_Parent_serverStuff_a_0Wq8TkNlVcM",
  "path": "",
  "extension": "js",
  "parent": "s_24PkzVg0h0U",
  "ctxKind": "function",
  "ctxName": "$",
  "captures": false,
  "loc": [
    538,
    587
  ]
}
*/
============================= test.tsx_useTask_NEuTKj8j8Nc.js (ENTRY POINT)==

export const s_NEuTKj8j8Nc = ()=>{
// Code
};


Some("{\"version\":3,\"sources\":[\"/user/qwik/src/test.tsx\"],\"names\":[],\"mappings\":\"6BAgCU;AACR,OAAO;AACR\"}")
/*
{
  "origin": "test.tsx",
  "name": "s_NEuTKj8j8Nc",
  "entry": null,
  "displayName": "test.tsx_useTask",
  "hash": "NEuTKj8j8Nc",
  "canonicalFilename": "test.tsx_useTask_NEuTKj8j8Nc",
  "path": "",
  "extension": "js",
  "parent": "s_0TaiDayHrlo",
  "ctxKind": "function",
  "ctxName": "useTask$",
  "captures": false,
  "loc": [
    724,
    744
  ]
}
*/
== DIAGNOSTICS ==

[]
